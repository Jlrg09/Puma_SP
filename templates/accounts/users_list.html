{% extends 'base.html' %}
{% block title %}Usuarios{% endblock %}
{% block content %}
<h1>Usuarios</h1>
<form method="get" class="row g-2 mb-3">
  <div class="col-12 col-md-2">
    <input class="form-control" type="text" name="q" placeholder="Buscar" value="{{ filters.q }}">
  </div>
  <div class="col-6 col-md-2">
    <select name="role" class="form-select">
      <option value="">Rol</option>
      <option value="JEFE" {% if filters.role == 'JEFE' %}selected{% endif %}>Jefe</option>
      <option value="SUPERVISOR" {% if filters.role == 'SUPERVISOR' %}selected{% endif %}>Supervisor</option>
      <option value="TECNICO" {% if filters.role == 'TECNICO' %}selected{% endif %}>Técnico</option>
      <option value="UNASSIGNED" {% if filters.role == 'UNASSIGNED' %}selected{% endif %}>Sin rol</option>
    </select>
  </div>
  <div class="col-6 col-md-3">
    <select name="office" class="form-select">
      <option value="">Oficina</option>
      {% for o in offices %}
        <option value="{{ o.id }}" {% if filters.office == o.id %}selected{% endif %}>{{ o.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-6 col-md-2">
    <select name="approved" class="form-select">
      <option value="">Aprobado</option>
      <option value="1" {% if filters.approved == '1' %}selected{% endif %}>Sí</option>
      <option value="0" {% if filters.approved == '0' %}selected{% endif %}>No</option>
    </select>
  </div>
  <div class="col-6 col-md-2">
    <select name="active" class="form-select">
      <option value="">Activo</option>
      <option value="1" {% if filters.active == '1' %}selected{% endif %}>Sí</option>
      <option value="0" {% if filters.active == '0' %}selected{% endif %}>No</option>
    </select>
  </div>
  <div class="col-12">
    <button class="btn btn-outline-secondary">Filtrar</button>
    <a class="btn btn-link" href="/accounts/users/">Limpiar</a>
  </div>
</form>
<table class="table table-sm align-middle">
  <thead>
    <tr>
      <th>Usuario</th><th>Email</th><th>Aprobado</th><th>Activo</th><th>Rol</th><th>Oficina</th><th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for u in users %}
      <tr>
        <td>{{ u.username }}</td>
        <td>{{ u.email }}</td>
        <td>{{ u.approved|yesno:"Sí,No" }}</td>
        <td>{{ u.is_active|yesno:"Sí,No" }}</td>
        <td>{{ u.get_role_display }}</td>
        <td>{{ u.office }}</td>
        <td>
          <a class="btn btn-sm btn-outline-primary" href="/accounts/users/{{u.id}}/">Editar</a>
          {% if not u.approved %}
            <a class="btn btn-sm btn-success" href="/accounts/approve/{{u.id}}/">Aprobar</a>
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="7" class="text-muted">Sin usuarios.</td></tr>
    {% endfor %}
  </tbody>
</table>

{% if users.paginator.num_pages > 1 %}
<nav aria-label="Paginación" class="mt-3">
  <ul class="pagination">
    {% if users.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ users.previous_page_number }}&role={{ filters.role }}&office={{ filters.office }}&approved={{ filters.approved }}&active={{ filters.active }}&q={{ filters.q }}">Anterior</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Anterior</span></li>
    {% endif %}
    <li class="page-item disabled"><span class="page-link">Página {{ users.number }} de {{ users.paginator.num_pages }}</span></li>
    {% if users.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ users.next_page_number }}&role={{ filters.role }}&office={{ filters.office }}&approved={{ filters.approved }}&active={{ filters.active }}&q={{ filters.q }}">Siguiente</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}
