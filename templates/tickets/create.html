{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block title %}Nuevo Requerimiento - Gestor de Servicios{% endblock %}
{% block content %}

<div class="row justify-content-center">
  <div class="col-12 col-lg-8">
    <!-- Encabezado -->
    <div class="mb-4">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="/tickets/" class="text-decoration-none">
              <i class="bi bi-list-task me-1"></i>Requerimientos
            </a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">Nuevo</li>
        </ol>
      </nav>
      
      <h1 class="page-title">
        <i class="bi bi-plus-circle me-2"></i>Nuevo Requerimiento
      </h1>
      <p class="text-muted">Crea un nuevo requerimiento de servicio técnico</p>
    </div>

    <!-- Formulario -->
    <div class="card shadow-lg border-0">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="bi bi-clipboard-plus me-2"></i>Información del Requerimiento
        </h5>
      </div>
      <div class="card-body p-4">
        <form method="post" class="needs-validation" novalidate>
          {% csrf_token %}
          
          <div class="row g-4">
            <!-- Información del solicitante -->
            <div class="col-12">
              <h6 class="section-title">
                <i class="bi bi-person me-1"></i>Información del Solicitante
              </h6>
            </div>
            
            <div class="col-md-6">
              <label for="{{ form.requester_name.id_for_label }}" class="form-label fw-medium">
                <i class="bi bi-person me-1"></i>Nombre del Solicitante *
              </label>
              <input type="text" 
                     name="requester_name" 
                     class="form-control" 
                     id="{{ form.requester_name.id_for_label }}"
                     placeholder="Nombre completo de quien solicita"
                     value="{{ form.requester_name.value|default:'' }}"
                     required>
              {% if form.requester_name.errors %}
                <div class="invalid-feedback d-block">
                  {{ form.requester_name.errors.0 }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <label for="{{ form.requester_office_text.id_for_label }}" class="form-label fw-medium">
                <i class="bi bi-building me-1"></i>Oficina del Solicitante *
              </label>
              <input type="text" 
                     name="requester_office_text" 
                     class="form-control" 
                     id="{{ form.requester_office_text.id_for_label }}"
                     placeholder="Oficina o departamento"
                     value="{{ form.requester_office_text.value|default:'' }}"
                     required>
              {% if form.requester_office_text.errors %}
                <div class="invalid-feedback d-block">
                  {{ form.requester_office_text.errors.0 }}
                </div>
              {% endif %}
            </div>

            <!-- Detalles del requerimiento -->
            <div class="col-12">
              <hr class="my-4">
              <h6 class="section-title">
                <i class="bi bi-gear me-1"></i>Detalles del Requerimiento
              </h6>
            </div>

            <div class="col-md-6">
              <label for="{{ form.assigned_office.id_for_label }}" class="form-label fw-medium">
                <i class="bi bi-geo-alt me-1"></i>Oficina Asignada *
              </label>
              <select name="assigned_office" 
                      class="form-select" 
                      id="{{ form.assigned_office.id_for_label }}"
                      required>
                <option value="">Selecciona una oficina...</option>
                {% for choice in form.assigned_office.field.choices %}
                  {% if choice.0 %}
                    <option value="{{ choice.0 }}" 
                            {% if form.assigned_office.value == choice.0|stringformat:"s" %}selected{% endif %}>
                      {{ choice.1 }}
                    </option>
                  {% endif %}
                {% endfor %}
              </select>
              {% if form.assigned_office.errors %}
                <div class="invalid-feedback d-block">
                  {{ form.assigned_office.errors.0 }}
                </div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <label for="{{ form.priority.id_for_label }}" class="form-label fw-medium">
                <i class="bi bi-flag me-1"></i>Prioridad *
              </label>
              <select name="priority" 
                      class="form-select" 
                      id="{{ form.priority.id_for_label }}"
                      required>
                <option value="">Selecciona prioridad...</option>
                {% for choice in form.priority.field.choices %}
                  <option value="{{ choice.0 }}" 
                          {% if form.priority.value == choice.0 %}selected{% endif %}>
                    {% if choice.0 == 'ALTA' %}🔴{% elif choice.0 == 'MEDIA' %}🟡{% else %}🟢{% endif %}
                    {{ choice.1 }}
                  </option>
                {% endfor %}
              </select>
              {% if form.priority.errors %}
                <div class="invalid-feedback d-block">
                  {{ form.priority.errors.0 }}
                </div>
              {% endif %}
            </div>

            <div class="col-12">
              <label for="{{ form.description.id_for_label }}" class="form-label fw-medium">
                <i class="bi bi-chat-left-text me-1"></i>Descripción del Problema *
              </label>
              <textarea name="description" 
                        class="form-control" 
                        id="{{ form.description.id_for_label }}"
                        rows="5"
                        placeholder="Describe detalladamente el problema o servicio requerido..."
                        required>{{ form.description.value|default:'' }}</textarea>
              <div class="form-text">
                <i class="bi bi-info-circle me-1"></i>
                Proporciona toda la información relevante para facilitar la resolución
              </div>
              {% if form.description.errors %}
                <div class="invalid-feedback d-block">
                  {{ form.description.errors.0 }}
                </div>
              {% endif %}
            </div>
          </div>

          {% if form.non_field_errors %}
            <div class="alert alert-danger mt-4" role="alert">
              <i class="bi bi-exclamation-triangle me-2"></i>
              {{ form.non_field_errors.0 }}
            </div>
          {% endif %}

          <!-- Botones de acción -->
          <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
            <a class="btn btn-secondary" href="/tickets/">
              <i class="bi bi-x-circle me-2"></i>Cancelar
            </a>
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-check-circle me-2"></i>Crear Requerimiento
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Información adicional -->
    <div class="card mt-4 border-0 bg-light">
      <div class="card-body text-center">
        <div class="row g-3">
          <div class="col-md-4">
            <i class="bi bi-clock text-primary mb-2" style="font-size: 1.5rem;"></i>
            <h6 class="fw-bold">Proceso Rápido</h6>
            <small class="text-muted">Tu requerimiento será asignado automáticamente</small>
          </div>
          <div class="col-md-4">
            <i class="bi bi-bell text-primary mb-2" style="font-size: 1.5rem;"></i>
            <h6 class="fw-bold">Notificaciones</h6>
            <small class="text-muted">Recibirás actualizaciones del progreso</small>
          </div>
          <div class="col-md-4">
            <i class="bi bi-shield-check text-primary mb-2" style="font-size: 1.5rem;"></i>
            <h6 class="fw-bold">Seguimiento</h6>
            <small class="text-muted">Podrás hacer seguimiento en tiempo real</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .form-control:focus, .form-select:focus {
    border-color: var(--primary-blue-light);
    box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.15);
  }
  
  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }
  
  .section-title {
    color: var(--primary-blue);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 0.5rem;
  }
</style>
{% endblock %}
